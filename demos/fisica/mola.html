<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Física Divertida - Mola Realista</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css">
    <style>
       body { background: #000; margin: 0; overflow: hidden; height: 95%; }

        #controls {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 200px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 5px;
            color: #fff;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <div id="controls">
        <input type="range" id="stiffness" min="0.1" max="1" step="0.1" value="0.5" class="form-range mb-1">
        <small>Rigidez: <span id="stiffnessValue">0.5</span></small>
        <input type="range" id="length" min="100" max="300" step="10" value="200" class="form-range mb-1">
        <small>Comprimento: <span id="lengthValue">200</span> px</small>
        <button id="reset" class="btn btn-sm btn-outline-light w-100 mt-1">Reiniciar</button>
    </div>

    <script>
        let engine, world, ground, anchor, mass, spring, block, boundaries;
        let mouseConstraint, canvas;

        function setup() {
            canvas = createCanvas(windowWidth, windowHeight * 0.95);

            // Configuração do motor Matter.js
            engine = Matter.Engine.create();
            world = engine.world;

            const mouse = Matter.Mouse.create(canvas.elt);
            mouseConstraint = Matter.MouseConstraint.create(engine, {
                mouse: mouse,
                constraint: {
                    stiffness: 0.2,
                    render: { visible: false }
                }
            });

            mouse.pixelRatio = pixelDensity();

            createSimulation();

            // Rodar o motor de física
            Matter.Engine.run(engine);
        }

        function createSimulation() {
            Matter.World.clear(world);

            // Ponto fixo da mola
            anchor = Matter.Bodies.circle(width / 2, 200, 10, {
                isStatic: true,
                render: { fillStyle: '#4fc3f7' }
            });

            // Massa conectada à mola
            mass = Matter.Bodies.circle(width / 2, 300, 20, {
                restitution: 0.9,
                frictionAir: 0.02,
                render: { fillStyle: '#f04a49' }
            });

            // Conexão da mola (Joint)
            spring = Matter.Constraint.create({
                bodyA: anchor,
                bodyB: mass,
                length: 200, // Comprimento inicial da mola
                stiffness: 0.5, // Rigidez inicial
            });

            // Limites da cena
            const boundaries = [
                Matter.Bodies.rectangle(width / 2, height, width, 20, {
                    isStatic: true,
                    render: { visible: false }
                }),
                Matter.Bodies.rectangle(0, height / 2, 20, height, {
                    isStatic: true,
                    render: { visible: false }
                }),
                Matter.Bodies.rectangle(width, height / 2, 20, height, {
                    isStatic: true,
                    render: { visible: false }
                }),
                Matter.Bodies.rectangle(width / 2, 0, width, 20, {
                    isStatic: true,
                    render: { visible: false }
                })
            ];

            // Bloco interativo
            block = Matter.Bodies.rectangle(width / 2 - 200, height - 300, 40, 40, {
                restitution: 0.9,
                frictionAir: 0.01,
                render: { fillStyle: '#29b6f6' }
            });

            // Adicionar objetos ao mundo
            Matter.World.add(world, [anchor, mass, spring, block, ...boundaries]);
            Matter.World.add(world, mouseConstraint);
        }

        function draw() {
            background(0);

            drawRealisticSpring(anchor.position, mass.position);

            // Desenhar âncora
            fill('#4fc3f7');
            noStroke();
            ellipse(anchor.position.x, anchor.position.y, 20);

            // Desenhar massa
            fill('#f04a49');
            noStroke();
            ellipse(mass.position.x, mass.position.y, 40);

            // Desenhar bloco
            fill('#29b6f6');
            noStroke();
            rectMode(CENTER);
            rect(block.position.x, block.position.y, 40, 40);
        }

        // Função para desenhar uma mola realista como Matter.js
        function drawRealisticSpring(start, end) {
            const numSegments = 12; // Quantidade de segmentos
            const amplitude = 15; // Altura das ondas da mola

            stroke(255);
            strokeWeight(2);
            noFill();

            beginShape();
            for (let i = 0; i <= numSegments; i++) {
                const t = i / numSegments;
                const x = lerp(start.x, end.x, t);
                const y = lerp(start.y, end.y, t) + (i % 2 === 0 ? -amplitude : amplitude);
                vertex(x, y);
            }
            endShape();
        }

        // Atualizar sliders
        document.getElementById('stiffness').addEventListener('input', (e) => {
            spring.stiffness = parseFloat(e.target.value);
            document.getElementById('stiffnessValue').textContent = e.target.value;
        });

        document.getElementById('length').addEventListener('input', (e) => {
            spring.length = parseInt(e.target.value);
            document.getElementById('lengthValue').textContent = e.target.value;
        });

        // Reiniciar simulação
        document.getElementById('reset').addEventListener('click', () => {
            createSimulation();
        });

        // Ajustar tamanho ao redimensionar a janela
        function windowResized() {
            resizeCanvas(windowWidth, windowHeight * 0.95);
        }
    </script>
</body>

</html>
